<?xml version="1.0" encoding="UTF-8" ?>
<funcs>

	<func id="100" name="selectStore" des="查询自己的店铺">

		<job result="user" one="true">select nick,portrait,total,store from user where id = ${userid}</job>
	</func>

	<func id="101" name="addStore" des="开店">
		<!-- 判断开店条件，只要有一个订单已经付款，就可以开店。 -->
		<job result="paidOrder" one="true">select id from orders where userid = ${userid} and state >= 2 limit 0,1</job><!-- 查询是否有已付款订单 -->
		<job>Eq(${paidOrder},null,'请您先在“和风商城”购买商品，然后才能开店。')</job><!-- 没有已付款订单时直接提示用户 -->

		<!-- 设置开店状态 -->
		<job>update user set store=1 where id = ${userid}</job>

	</func>

	<func id="102" name="selectSubStore" des="查询自己的下级店铺">

		<job>select nick,portrait,total from user where parent = ${userid}</job>
	</func>

	<func id="103" name="selectSubSubStore" des="查询自己的下下级店铺">

		<job>select nick,portrait,total from user where parent in(select id from user where parent = ${userid})</job>
	</func>

</funcs>
