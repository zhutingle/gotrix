<?xml version="1.0" encoding="UTF-8" ?>
<funcs>

	<func id="200" name="selectUser" des="查询个人信息">

		<job result="userInfo" one="true">select user.id,nick,portrait,totalbuy,store,score,parent,count(distinct collection.goodid) collectionCount,count(distinct history.goodid) historyCount from user,collection,history where user.id = ${userid} and user.id = collection.userid and user.id = history.userid</job>
		<job result="parentInfo" one="true">select user2.nick from user user1,user user2 where user1.id = ${userid} and user1.parent = user2.id</job>
		<job result="ordersInfo">select state,count(1) count from orders where userid = ${userid} and (state = 1 or state = 3 or state = 4 or state = 6) group by state</job>
		<job>Jset('userInfo',${userInfo},'parentInfo',${parentInfo},'ordersInfo',${ordersInfo})</job>
	</func>

	<func id="201" name="selectAllOrders" des="查询全部订单">

		<job>select orders.id,orders.state,orders.money,orders.time,dicti.text,shopping.attach,shopping.count,goods.id goodid,goods.`name`,goods.icon

			from orders,dicti,shopping,goods
			where
			orders.userid = ${userid} and
			dicti.dictid = 1 and
			orders.state = dicti.`value` and
			orders.id = shopping.orderid and
			shopping.userid = orders.userid and
			shopping.goodid = goods.id

			order by time desc;
		</job>
	</func>

	<func id="202" name="selectStateOrder" des="查询某个状态的订单">
		<int name="state" must="true" />

		<job>select orders.id,orders.state,orders.money,orders.time,dicti.text,shopping.attach,shopping.count,goods.id goodid,goods.`name`,goods.icon

			from orders,dicti,shopping,goods
			where
			orders.userid = ${userid} and
			orders.state = ${state} and
			dicti.dictid = 1 and
			orders.state = dicti.`value` and
			orders.id = shopping.orderid and
			shopping.userid = orders.userid and
			shopping.goodid = goods.id

			order by time desc;
		</job>
	</func>

</funcs>
